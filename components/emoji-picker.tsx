"use client"

import { useState } from "react"
import { Button } from "@/components/ui/button"
import {
  Popover,
  PopoverContent,
  PopoverTrigger,
} from "@/components/ui/popover"
import { Smile } from "lucide-react"
import { Input } from "@/components/ui/input"

// Common emoji categories
const EMOJI_CATEGORIES = [
  {
    name: "M·∫∑t c∆∞·ªùi v√† h√¨nh ng∆∞·ªùi",
    icon: "üòÄ",
    emojis: [
      "üòÄ", "üòÉ", "üòÑ", "üòÅ", "üòÜ", "üòÖ", "ü§£", "üòÇ",
      "üôÇ", "üôÉ", "üòâ", "üòä", "üòá", "ü•∞", "üòç", "ü§©",
      "üòò", "üòó", "üòö", "üòô", "ü•≤", "üòã", "üòõ", "üòú",
      "ü§™", "üòù", "ü§ë", "ü§ó", "ü§≠", "ü§´", "ü§î", "ü§ê",
      "ü§®", "üòê", "üòë", "üò∂", "üòè", "üòí", "üôÑ", "üò¨",
      "ü§•", "üòå", "üòî", "üò™", "ü§§", "üò¥", "üò∑", "ü§í",
      "ü§ï", "ü§¢", "ü§Æ", "ü§ß", "ü•µ", "ü•∂", "ü•¥", "üòµ",
      "ü§Ø", "ü§†", "ü•≥", "ü•∏", "üòé", "ü§ì", "üßê", "üòï",
      "üòü", "üôÅ", "‚òπÔ∏è", "üòÆ", "üòØ", "üò≤", "üò≥", "ü•∫",
      "üò¶", "üòß", "üò®", "üò∞", "üò•", "üò¢", "üò≠", "üò±",
      "üòñ", "üò£", "üòû", "üòì", "üò©", "üò´", "ü•±", "üò§",
      "üò°", "üò†", "ü§¨", "üòà", "üëø", "üíÄ", "‚ò†Ô∏è", "üí©",
    ],
  },
  {
    name: "C·ª≠ ch·ªâ",
    icon: "üëã",
    emojis: [
      "üëã", "ü§ö", "üñêÔ∏è", "‚úã", "üññ", "üëå", "ü§å", "ü§è",
      "‚úåÔ∏è", "ü§û", "ü§ü", "ü§ò", "ü§ô", "üëà", "üëâ", "üëÜ",
      "üñï", "üëá", "‚òùÔ∏è", "üëç", "üëé", "‚úä", "üëä", "ü§õ",
      "ü§ú", "üëè", "üôå", "üëê", "ü§≤", "ü§ù", "üôè", "‚úçÔ∏è",
      "üí™", "ü¶æ", "ü¶ø", "ü¶µ", "ü¶∂", "üëÇ", "ü¶ª", "üëÉ",
    ],
  },
  {
    name: "Tr√°i tim",
    icon: "‚ù§Ô∏è",
    emojis: [
      "‚ù§Ô∏è", "üß°", "üíõ", "üíö", "üíô", "üíú", "üñ§", "ü§ç",
      "ü§é", "üíî", "‚ù£Ô∏è", "üíï", "üíû", "üíì", "üíó", "üíñ",
      "üíò", "üíù", "üíü", "‚òÆÔ∏è", "‚úùÔ∏è", "‚ò™Ô∏è", "üïâÔ∏è", "‚ò∏Ô∏è",
    ],
  },
  {
    name: "ƒê·ªông v·∫≠t",
    icon: "üê∂",
    emojis: [
      "üê∂", "üê±", "üê≠", "üêπ", "üê∞", "ü¶ä", "üêª", "üêº",
      "üê®", "üêØ", "ü¶Å", "üêÆ", "üê∑", "üêΩ", "üê∏", "üêµ",
      "üôà", "üôâ", "üôä", "üêí", "üêî", "üêß", "üê¶", "üê§",
      "üê£", "üê•", "ü¶Ü", "ü¶Ö", "ü¶â", "ü¶á", "üê∫", "üêó",
      "üê¥", "ü¶Ñ", "üêù", "üêõ", "ü¶ã", "üêå", "üêû", "üêú",
      "ü¶ü", "ü¶ó", "üï∑Ô∏è", "üï∏Ô∏è", "ü¶Ç", "üê¢", "üêç", "ü¶é",
    ],
  },
  {
    name: "Th·ª±c ph·∫©m",
    icon: "üçï",
    emojis: [
      "üçé", "üçä", "üçã", "üçå", "üçâ", "üçá", "üçì", "üçà",
      "üçí", "üçë", "ü•≠", "üçç", "ü••", "ü•ù", "üçÖ", "üçÜ",
      "ü•ë", "ü•¶", "ü•¨", "ü•í", "üå∂Ô∏è", "üåΩ", "ü•ï", "üßÑ",
      "üßÖ", "ü•î", "üç†", "ü•ê", "ü•Ø", "üçû", "ü•ñ", "ü•®",
      "üßÄ", "ü•ö", "üç≥", "üßà", "ü•û", "üßá", "ü•ì", "ü•©",
      "üçó", "üçñ", "üå≠", "üçî", "üçü", "üçï", "ü•™", "ü•ô",
      "üßÜ", "üåÆ", "üåØ", "ü•ó", "ü•ò", "ü•´", "üçù", "üçú",
      "üç≤", "üçõ", "üç£", "üç±", "ü•ü", "üç§", "üçô", "üçö",
      "üçò", "üç•", "ü•†", "ü•Æ", "üç¢", "üç°", "üçß", "üç®",
      "üç¶", "ü•ß", "üßÅ", "üç∞", "üéÇ", "üçÆ", "üç≠", "üç¨",
      "üç´", "üçø", "üç©", "üç™", "üå∞", "ü•ú", "üçØ", "ü•õ",
      "üçº", "‚òï", "üçµ", "üßÉ", "ü•§", "üç∂", "üç∫", "üçª",
      "ü•Ç", "üç∑", "ü•É", "üç∏", "üçπ", "üßâ", "üçæ", "üßä",
    ],
  },
  {
    name: "Ho·∫°t ƒë·ªông",
    icon: "‚öΩ",
    emojis: [
      "‚öΩ", "üèÄ", "üèà", "‚öæ", "ü•é", "üéæ", "üèê", "üèâ",
      "ü•è", "üé±", "ü™Ä", "üèì", "üè∏", "üèí", "üèë", "ü•ç",
      "üèè", "ü•Ö", "‚õ≥", "ü™Å", "üèπ", "üé£", "ü§ø", "ü•ä",
      "ü•ã", "üéΩ", "üõπ", "üõº", "üõ∑", "‚õ∏Ô∏è", "ü•å", "üéø",
      "‚õ∑Ô∏è", "üèÇ", "ü™Ç", "üèãÔ∏è", "ü§º", "ü§∏", "ü§∫", "‚õπÔ∏è",
      "ü§æ", "üèåÔ∏è", "üèá", "üßò", "üèä", "ü§Ω", "üö£", "üßó",
      "üö¥", "üöµ", "üé™", "üé≠", "üé®", "üé¨", "üé§", "üéß",
      "üéº", "üéπ", "ü•Å", "üé∑", "üé∫", "üé∏", "ü™ï", "üéª",
    ],
  },
  {
    name: "Du l·ªãch",
    icon: "‚úàÔ∏è",
    emojis: [
      "üöó", "üöï", "üöô", "üöå", "üöé", "üèéÔ∏è", "üöì", "üöë",
      "üöí", "üöê", "üöö", "üöõ", "üöú", "ü¶Ø", "ü¶Ω", "ü¶º",
      "üõ¥", "üö≤", "üõµ", "üèçÔ∏è", "üõ∫", "üö®", "üöî", "üöç",
      "üöò", "üöñ", "üö°", "üö†", "üöü", "üöÉ", "üöã", "üöû",
      "üöù", "üöÑ", "üöÖ", "üöà", "üöÇ", "üöÜ", "üöá", "üöä",
      "üöâ", "‚úàÔ∏è", "üõ´", "üõ¨", "üõ©Ô∏è", "üí∫", "üõ∞Ô∏è", "üöÄ",
      "üõ∏", "üöÅ", "üõ∂", "‚õµ", "üö§", "üõ•Ô∏è", "üõ≥Ô∏è", "‚õ¥Ô∏è",
      "üö¢", "‚öì", "‚õΩ", "üöß", "üö¶", "üö•", "üöè", "üó∫Ô∏è",
    ],
  },
  {
    name: "ƒê·ªì v·∫≠t",
    icon: "üí°",
    emojis: [
      "‚åö", "üì±", "üì≤", "üíª", "‚å®Ô∏è", "üñ•Ô∏è", "üñ®Ô∏è", "üñ±Ô∏è",
      "üñ≤Ô∏è", "üïπÔ∏è", "üóúÔ∏è", "üíΩ", "üíæ", "üíø", "üìÄ", "üìº",
      "üì∑", "üì∏", "üìπ", "üé•", "üìΩÔ∏è", "üéûÔ∏è", "üìû", "‚òéÔ∏è",
      "üìü", "üì†", "üì∫", "üìª", "üéôÔ∏è", "üéöÔ∏è", "üéõÔ∏è", "üß≠",
      "‚è±Ô∏è", "‚è≤Ô∏è", "‚è∞", "üï∞Ô∏è", "‚åõ", "‚è≥", "üì°", "üîã",
      "üîå", "üí°", "üî¶", "üïØÔ∏è", "ü™î", "üßØ", "üõ¢Ô∏è", "üí∏",
      "üíµ", "üí¥", "üí∂", "üí∑", "üí∞", "üí≥", "üíé", "‚öñÔ∏è",
    ],
  },
  {
    name: "Bi·ªÉu t∆∞·ª£ng",
    icon: "‚ù§Ô∏è",
    emojis: [
      "‚ù§Ô∏è", "üß°", "üíõ", "üíö", "üíô", "üíú", "üñ§", "ü§ç",
      "ü§é", "üíî", "‚ù£Ô∏è", "üíï", "üíû", "üíì", "üíó", "üíñ",
      "üíò", "üíù", "üíü", "‚òÆÔ∏è", "‚úùÔ∏è", "‚ò™Ô∏è", "üïâÔ∏è", "‚ò∏Ô∏è",
      "‚ú°Ô∏è", "üîØ", "üïé", "‚òØÔ∏è", "‚ò¶Ô∏è", "üõê", "‚õé", "‚ôà",
      "‚ôâ", "‚ôä", "‚ôã", "‚ôå", "‚ôç", "‚ôé", "‚ôè", "‚ôê",
      "‚ôë", "‚ôí", "‚ôì", "üÜî", "‚öõÔ∏è", "üâë", "‚ò¢Ô∏è", "‚ò£Ô∏è",
      "üì¥", "üì≥", "üà∂", "üàö", "üà∏", "üà∫", "üà∑Ô∏è", "‚ú¥Ô∏è",
      "üÜö", "üíÆ", "üâê", "„äôÔ∏è", "„äóÔ∏è", "üà¥", "üàµ", "üàπ",
      "üà≤", "üÖ∞Ô∏è", "üÖ±Ô∏è", "üÜé", "üÜë", "üÖæÔ∏è", "üÜò", "‚ùå",
      "‚≠ï", "üõë", "‚õî", "üìõ", "üö´", "üíØ", "üí¢", "‚ô®Ô∏è",
      "üö∑", "üöØ", "üö≥", "üö±", "üîû", "üìµ", "üö≠", "‚ùó",
      "‚ùï", "‚ùì", "‚ùî", "‚ÄºÔ∏è", "‚ÅâÔ∏è", "üîÖ", "üîÜ", "„ÄΩÔ∏è",
      "‚ö†Ô∏è", "üö∏", "üî±", "‚öúÔ∏è", "üî∞", "‚ôªÔ∏è", "‚úÖ", "üàØ",
      "üíπ", "‚ùáÔ∏è", "‚ú≥Ô∏è", "‚ùé", "üåê", "üí†", "‚ìÇÔ∏è", "üåÄ",
      "üí§", "üèß", "üöæ", "‚ôø", "üÖøÔ∏è", "üà≥", "üàÇÔ∏è", "üõÇ",
      "üõÉ", "üõÑ", "üõÖ", "üöπ", "üö∫", "üöº", "‚ößÔ∏è", "üöª",
      "üöÆ", "üé¶", "üì∂", "üàÅ", "üî£", "‚ÑπÔ∏è", "üî§", "üî°",
      "üî†", "üÜñ", "üÜó", "üÜô", "üÜí", "üÜï", "üÜì", "0Ô∏è‚É£",
      "1Ô∏è‚É£", "2Ô∏è‚É£", "3Ô∏è‚É£", "4Ô∏è‚É£", "5Ô∏è‚É£", "6Ô∏è‚É£", "7Ô∏è‚É£", "8Ô∏è‚É£",
      "9Ô∏è‚É£", "üîü", "üî¢", "#Ô∏è‚É£", "*Ô∏è‚É£", "‚èèÔ∏è", "‚ñ∂Ô∏è", "‚è∏Ô∏è",
      "‚èØÔ∏è", "‚èπÔ∏è", "‚è∫Ô∏è", "‚è≠Ô∏è", "‚èÆÔ∏è", "‚è©", "‚è™", "‚è´",
      "‚è¨", "‚óÄÔ∏è", "üîº", "üîΩ", "‚û°Ô∏è", "‚¨ÖÔ∏è", "‚¨ÜÔ∏è", "‚¨áÔ∏è",
      "‚ÜóÔ∏è", "‚ÜòÔ∏è", "‚ÜôÔ∏è", "‚ÜñÔ∏è", "‚ÜïÔ∏è", "‚ÜîÔ∏è", "‚Ü™Ô∏è", "‚Ü©Ô∏è",
      "‚§¥Ô∏è", "‚§µÔ∏è", "üîÄ", "üîÅ", "üîÇ", "üîÑ", "üîÉ", "üéµ",
      "üé∂", "‚ûï", "‚ûñ", "‚ûó", "‚úñÔ∏è", "‚ôæÔ∏è", "üí≤", "üí±",
      "‚Ñ¢Ô∏è", "¬©Ô∏è", "¬ÆÔ∏è", "„Ä∞Ô∏è", "‚û∞", "‚ûø", "üîö", "üîô",
      "üîõ", "üîù", "üîú", "‚úîÔ∏è", "‚òëÔ∏è", "üîò", "üî¥", "üü†",
      "üü°", "üü¢", "üîµ", "üü£", "‚ö´", "‚ö™", "üü§", "üî∫",
      "üîª", "üî∏", "üîπ", "üî∂", "üî∑", "üî≥", "üî≤", "‚ñ™Ô∏è",
      "‚ñ´Ô∏è", "‚óæ", "‚óΩ", "‚óºÔ∏è", "‚óªÔ∏è", "üü•", "üüß", "üü®",
      "üü©", "üü¶", "üü™", "‚¨õ", "‚¨ú", "üü´", "üîà", "üîá",
      "üîâ", "üîä", "üîî", "üîï", "üì£", "üì¢", "üëÅÔ∏è‚Äçüó®Ô∏è", "üí¨",
      "üí≠", "üóØÔ∏è", "‚ô†Ô∏è", "‚ô£Ô∏è", "‚ô•Ô∏è", "‚ô¶Ô∏è", "üÉè", "üé¥",
      "üÄÑ", "üïê", "üïë", "üïí", "üïì", "üïî", "üïï", "üïñ",
      "üïó", "üïò", "üïô", "üïö", "üïõ", "üïú", "üïù", "üïû",
      "üïü", "üï†", "üï°", "üï¢", "üï£", "üï§", "üï•", "üï¶",
      "üïß",
    ],
  },
]

interface EmojiPickerProps {
  onEmojiSelect: (emoji: string) => void
  trigger?: React.ReactNode
  side?: "top" | "right" | "bottom" | "left"
  align?: "start" | "center" | "end"
}

export function EmojiPicker({
  onEmojiSelect,
  trigger,
  side = "top",
  align = "end",
}: EmojiPickerProps) {
  const [open, setOpen] = useState(false)
  const [searchQuery, setSearchQuery] = useState("")
  const [selectedCategory, setSelectedCategory] = useState(0)

  const handleEmojiClick = (emoji: string) => {
    onEmojiSelect(emoji)
    setOpen(false)
    setSearchQuery("")
  }

  // Filter emojis based on search query
  const filteredCategories = searchQuery
    ? EMOJI_CATEGORIES.map((category) => ({
        ...category,
        emojis: category.emojis.filter((emoji) =>
          emoji.includes(searchQuery)
        ),
      })).filter((category) => category.emojis.length > 0)
    : EMOJI_CATEGORIES

  const currentCategory = searchQuery
    ? filteredCategories[0]
    : EMOJI_CATEGORIES[selectedCategory]

  return (
    <Popover open={open} onOpenChange={setOpen}>
      <PopoverTrigger asChild>
        {trigger || (
          <Button
            variant="ghost"
            size="icon"
            className="h-9 w-9 shrink-0"
            type="button"
          >
            <Smile className="h-5 w-5" />
          </Button>
        )}
      </PopoverTrigger>
      <PopoverContent
        className="w-[320px] p-0"
        side={side}
        align={align}
        sideOffset={8}
      >
        <div className="flex flex-col h-[400px]">
          {/* Search */}
          <div className="p-2 border-b">
            <Input
              placeholder="T√¨m ki·∫øm bi·ªÉu t∆∞·ª£ng c·∫£m x√∫c..."
              value={searchQuery}
              onChange={(e) => setSearchQuery(e.target.value)}
              className="h-8 text-sm"
            />
          </div>

          {/* Category tabs - hide when searching */}
          {!searchQuery && (
            <div className="flex gap-1 p-2 border-b overflow-x-auto">
              {EMOJI_CATEGORIES.map((category, index) => (
                <Button
                  key={index}
                  variant={selectedCategory === index ? "secondary" : "ghost"}
                  size="sm"
                  className="h-8 w-8 p-0 shrink-0"
                  onClick={() => setSelectedCategory(index)}
                  type="button"
                >
                  <span className="text-lg">{category.icon}</span>
                </Button>
              ))}
            </div>
          )}

          {/* Emoji grid with scrollbar */}
          <div className="flex-1 overflow-y-auto overflow-x-hidden">
            <div className="p-2">
              {searchQuery && filteredCategories.length === 0 ? (
                <div className="text-center text-sm text-muted-foreground py-8">
                  Kh√¥ng t√¨m th·∫•y bi·ªÉu t∆∞·ª£ng c·∫£m x√∫c
                </div>
              ) : searchQuery ? (
                // Show all filtered results when searching
                <div>
                  {filteredCategories.map((category, catIndex) => (
                    <div key={catIndex} className="mb-4">
                      <h3 className="text-xs font-medium text-muted-foreground mb-2">
                        {category.name}
                      </h3>
                      <div className="grid grid-cols-8 gap-1">
                        {category.emojis.map((emoji, emojiIndex) => (
                          <button
                            key={emojiIndex}
                            onClick={() => handleEmojiClick(emoji)}
                            className="h-9 w-9 flex items-center justify-center text-xl hover:bg-accent rounded transition-colors"
                            type="button"
                          >
                            {emoji}
                          </button>
                        ))}
                      </div>
                    </div>
                  ))}
                </div>
              ) : (
                // Show selected category
                <div>
                  <h3 className="text-xs font-medium text-muted-foreground mb-2">
                    {currentCategory.name}
                  </h3>
                  <div className="grid grid-cols-8 gap-1">
                    {currentCategory.emojis.map((emoji, index) => (
                      <button
                        key={index}
                        onClick={() => handleEmojiClick(emoji)}
                        className="h-9 w-9 flex items-center justify-center text-xl hover:bg-accent rounded transition-colors"
                        type="button"
                      >
                        {emoji}
                      </button>
                    ))}
                  </div>
                </div>
              )}
            </div>
          </div>
        </div>
      </PopoverContent>
    </Popover>
  )
}

